{
    "collab_server" : "",
    "contents" : "\n#' Create Session Token\n#'\n#' Create the session token needed for other DeepCrawl requests.\n#' Lasts for 6 hours.\n#'\n#' @param user User ID\n#' @param api_key API key\n#'\n#' @return A string with the session token\n#' @export\n#'\n#' @examples\n#'\n#' user    <- '42'\n#' api_key <- 'b72OqnAniXHgLAjA8VHCUQ10UQ7EzE-I7eYNLqqWXlSAxYa2JU3AtvRAaIwVDt5kvZJW8Y9tQTjGoOPYb6mIzw'\n#' session_token <- create_session_token(user, api_key)\n#'\ncreate_session_token <- function(user, api_key){\n\n  authenticate_url <- 'https://prod-1-dc-api-oopeix3r.deepcrawl.com/sessions'\n\n  session_response <- httr::POST(authenticate_url, httr::authenticate(user, api_key))\n\n  httr::stop_for_status(session_response)\n\n  if (httr::http_type(session_response) != \"application/json\") {\n    stop(\"API did not return json\", call. = FALSE)\n  }\n\n  parsed <- jsonlite::fromJSON(httr::content(session_response, \"text\", encoding = 'utf-8'), simplifyVector = FALSE)\n\n  return(parsed$token)\n\n}\n\n\n\n#' Create crawling project\n#'\n#' Set up a crawl\n#'\n#' @param name A character string giving a name for the project\n#' @param sites A list of sites to crawl\n#' @param session_token Session token from `create_session_token`.\n#' @param account_id The ID for the account (can be found with get_account_info)\n#'\n#' @return The crawl's ID number. Also, will define a crawl on deepweb.\n#' @export\n#'\n#' @examples\n#' sites <- c(\"http://scottishsalmon.co.uk/\", \"http://www.independent.co.uk/voices/comment/the-loss-of-scottish-salmon-is-a-cultural-catastrophe-10158356.html\")\n#' project_id <- create_project('test crawl', sites, session_token, 424)\n#'\ncreate_project <- function(name, site, session_token, account_id){\n\n  project_data <- list(\n    name = name,\n    site_primary = sites[1],\n    v2_crawl_type_codes = c('web', 'list', 'google_analytics', 'backlinks'),\n    crawl_rate = 1,\n    limit_levels_max = 1,\n    limit_pages_max = length(sites),\n    auto_finalize = TRUE,\n    start_urls = sites\n  )\n\n  url <- 'https://prod-1-dc-api-oopeix3r.deepcrawl.com'\n\n  session_response <- httr::POST(url,\n                                 path = c('accounts', account_id, 'projects'),\n                                 httr::add_headers('X-Auth-Token' = session_token),\n                                 body = project_data,\n                                 encode = 'json')\n\n  httr::stop_for_status(session_response)\n\n  if (httr::http_type(session_response) != \"application/json\") {\n    stop(\"API did not return json\", call. = FALSE)\n  }\n\n  parsed <- jsonlite::fromJSON(httr::content(session_response, \"text\", encoding = 'utf-8'), simplifyVector = FALSE)\n\n  return(parsed$id)\n\n}\n\n\n#' Create crawl\n#'\n#' Set a project's crawl to start\n#'\n#' @param session_token Session token from `create_session_token`.\n#' @param account_id The ID for the account (can be found with get_account_info)\n#' @param project_id The ID of the project, from `create_project`\n#'\n#' @return The crawl's ID number. Also, will define a crawl on deepweb.\n#' @export\n#'\n#' @examples\n#' crawl_id <- set_crawl_urls('test crawl', sites, session_token, 424)\n#'\ncreate_crawl <- function(session_token, account_id, project_id){\n\n  url <- 'https://prod-1-dc-api-oopeix3r.deepcrawl.com'\n\n  data <- list(status = 'crawling')\n\n  session_response <-  httr::POST(url,\n                                  httr::add_headers('X-Auth-Token' = session_token),\n                                  path = c('accounts', account_id, 'projects', project_id, 'crawls'),\n                                  body = data,\n                                  encoding = 'form')\n\n  httr::stop_for_status(session_response)\n\n  if (httr::http_type(session_response) != \"application/json\") {\n    stop(\"API did not return json\", call. = FALSE)\n  }\n\n  parsed <- jsonlite::fromJSON(httr::content(session_response, \"text\", encoding = 'utf-8'), simplifyVector = FALSE)\n\n  return(parsed$id)\n\n}\n\n\n\n",
    "created" : 1473345525576.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4038399783",
    "id" : "1AE0EDB",
    "lastKnownWriteTime" : 1473884828,
    "last_content_update" : 1473884828532,
    "path" : "~/Documents/APIs/deepcrawl/R/create.R",
    "project_path" : "R/create.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}